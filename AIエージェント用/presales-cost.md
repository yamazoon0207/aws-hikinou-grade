# コスト最適化ヒアリング

## 質問項目

### 1. 予算
- **質問**: 「月間の予算はどのくらいですか？」
  - 初期構築コスト
  - 月間運用コスト
  - 年間予算

- **質問**: 「コスト増加の許容範囲は？」
  - 固定予算
  - トラフィック連動で変動可能
  - 上限設定の必要性

### 2. 利用パターン
- **質問**: 「システムの利用パターンは？」
  - 24時間365日稼働
  - 営業時間のみ
  - 季節変動あり
  - イベント駆動

- **質問**: 「開発・検証環境の稼働時間は？」
  - 常時稼働
  - 営業時間のみ
  - 必要時のみ起動

### 3. コスト優先度
- **質問**: 「コストとパフォーマンスのバランスは？」
  - コスト最優先
  - パフォーマンス最優先
  - バランス重視

- **質問**: 「初期コストと運用コストのどちらを重視？」
  - 初期投資を抑えたい
  - 長期的な運用コストを抑えたい

### 4. リソース最適化
- **質問**: 「リザーブドインスタンスやSavings Plansの利用は可能？」
  - 1年契約
  - 3年契約
  - オンデマンドのみ

## AWSサービスマッピング

### コスト最適化戦略

#### コンピューティング
- **EC2 Spot Instances**: 最大90%割引（中断可能なワークロード）
- **Reserved Instances**: 最大72%割引（1年/3年契約）
- **Savings Plans**: 柔軟な割引プラン
- **Lambda**: 使用量ベース課金、アイドル時間なし
- **Fargate Spot**: コンテナのスポット利用

#### ストレージ
- **S3 Intelligent-Tiering**: 自動的に最適なストレージクラスに移行
- **S3 Glacier**: アーカイブ用の低コストストレージ
- **EBS gp3**: gp2より20%安価で高性能
- **EFS Infrequent Access**: アクセス頻度の低いファイル用

#### データベース
- **Aurora Serverless**: 使用量ベース課金
- **RDS Reserved Instances**: 最大69%割引
- **DynamoDB On-Demand**: 予測不可能なワークロード
- **DynamoDB Reserved Capacity**: 予測可能なワークロード

#### ネットワーク
- **CloudFront**: オリジンへのトラフィック削減
- **VPC Endpoints**: データ転送料金の削減
- **Direct Connect**: 大量データ転送時のコスト削減

### コスト管理ツール
- **Cost Explorer**: コスト分析と予測
- **Budgets**: 予算アラート設定
- **Cost Anomaly Detection**: 異常なコスト増加の検知
- **Compute Optimizer**: リソース最適化の推奨
- **Trusted Advisor**: コスト最適化の推奨事項

## チェックリスト

- [ ] 予算の確認
- [ ] 利用パターンの把握
- [ ] コスト優先度の確認
- [ ] リザーブド/Savings Plansの検討
- [ ] 開発環境の自動停止設定
- [ ] ストレージライフサイクルポリシー
- [ ] 不要リソースの定期削除
- [ ] コストアラートの設定
- [ ] タグ付け戦略（コスト配分）

## コスト見積もりテンプレート

### 月間コスト概算
```
コンピューティング:
- EC2/ECS/Lambda: $XXX
- Auto Scaling想定: 平常時X台、ピーク時Y台

ストレージ:
- S3: XXX GB × $0.023 = $XXX
- EBS: XXX GB × $0.10 = $XXX

データベース:
- RDS/DynamoDB: $XXX

ネットワーク:
- データ転送: XXX GB × $0.09 = $XXX
- CloudFront: XXX GB × $0.085 = $XXX

合計: $XXX/月
```

## ナレッジ（随時追加）

### 事例・ベストプラクティス
<!-- ここに案件で得た知見を追加してください -->

### コスト削減事例
<!-- 実際のコスト削減施策と効果を追加 -->



---

## 実案件ナレッジ

### TCO（総所有コスト）分析

#### オンプレミスとの比較

**オンプレミスコストの洗い出し:**
- ハードウェア購入費（サーバー、ストレージ、ネットワーク機器）
- ソフトウェアライセンス費
- データセンター費用（ラック代、電気代、空調代）
- 保守費用（ハードウェア保守、ソフトウェア保守）
- 人件費（構築、運用、保守）
- 更改費用（3〜5年サイクル）

**AWSコストの算出:**
- 初期構築費用（設計、構築、移行）
- 月額利用料（コンピューティング、ストレージ、ネットワーク）
- 運用保守費用（監視、パッチ適用、障害対応）
- サポート費用（AWSサポートプラン）

**TCO比較のポイント:**
- 3年間、5年間での総コスト比較
- 隠れコストの可視化
- スケーラビリティによる将来コストの違い

#### 隠れコストの洗い出し

**オンプレミスの隠れコスト:**
- 電気代（サーバー、空調）
- スペース代（データセンター、サーバールーム）
- 運用担当者の人件費
- 障害対応の時間外労働コスト
- 過剰スペックによる無駄（ピーク対応のための余剰リソース）

**AWSの隠れコスト:**
- データ転送料金（特にアウトバウンド）
- NAT Gatewayの料金
- EIPの料金（未使用時）
- CloudWatchログの保存料金
- スナップショットの保存料金

#### 移行コストの見積もり

**移行プロジェクトコスト:**
- 現状調査・分析
- 移行計画策定
- アプリケーション改修
- データ移行
- テスト・検証
- 並行稼働期間のコスト

**移行方式別のコスト:**
- リホスト（Lift & Shift）: 低コスト、短期間
- リプラットフォーム: 中コスト、中期間
- リファクタリング: 高コスト、長期間

### コスト配分とタグ戦略

#### タグ付けルールの策定

**必須タグの例:**
- Environment（本番、検証、開発）
- Project（プロジェクト名）
- CostCenter（コストセンター）
- Owner（責任者）
- Application（アプリケーション名）

**タグ付けのベストプラクティス:**
- 命名規則の統一
- タグの自動付与（Terraform、CloudFormation）
- タグポリシーの適用（AWS Organizations）
- 定期的なタグの棚卸し

#### コストセンター別の配分

**配分方法:**
- タグベースの配分
- アカウント別の配分（マルチアカウント戦略）
- リソースグループ別の配分

**Cost Allocation Tagsの活用:**
- コスト配分タグの有効化
- Cost Explorerでの分析
- 月次レポートの自動生成

### FinOps実践

#### コスト可視化

**ダッシュボード作成:**
- Cost Explorerによる可視化
- QuickSightによるカスタムダッシュボード
- サードパーティツール（CloudHealth、Cloudability）

**可視化すべき項目:**
- サービス別コスト
- リージョン別コスト
- プロジェクト別コスト
- 日次・月次のコスト推移
- 予算との比較

#### 定期的なコストレビュー

**レビュー頻度:**
- 日次: 異常なコスト増加の検知
- 週次: トレンド分析
- 月次: 予算との比較、最適化施策の検討
- 四半期: 中長期的な最適化計画

**レビュー項目:**
- 予算超過の有無
- 未使用リソースの特定
- 最適化機会の発見
- Reserved Instance/Savings Plansの活用状況

#### 無駄なリソースの特定

**チェック項目:**
- 停止中のEC2インスタンス
- 未アタッチのEBSボリューム
- 古いスナップショット
- 未使用のElastic IP
- 未使用のロードバランサー
- 低使用率のRDSインスタンス

**自動化ツール:**
- AWS Trusted Advisor
- AWS Compute Optimizer
- Cost Anomaly Detection
- Lambda関数による定期チェック

### 具体的なコスト削減施策

#### 開発環境の自動停止

**実装方法:**
- Instance Schedulerの利用
- Lambda + EventBridgeによる自動停止/起動
- Auto Scalingのスケジュールアクション

**削減効果:**
- 平日のみ稼働（9:00-19:00）: 約60%削減
- 営業日のみ稼働: 約70%削減

**対象リソース:**
- EC2インスタンス
- RDSインスタンス
- Redshiftクラスター

#### ストレージの最適化

**EBSボリュームの最適化:**
- gp2からgp3への移行（20%コスト削減）
- 未使用ボリュームの削除
- ボリュームサイズの適正化

**スナップショットの最適化:**
- 古いスナップショットの削除
- Data Lifecycle Managerによる自動管理
- クロスリージョンコピーの見直し

**S3の最適化:**
- ライフサイクルポリシーの設定
- Intelligent-Tieringの活用
- 不要なバージョンの削除

#### インスタンスサイズの最適化

**適正サイズの選定:**
- CloudWatch メトリクスの分析
- Compute Optimizerの推奨事項
- 実際の使用率に基づいたサイジング

**最適化の例:**
- CPU使用率が常に20%以下 → 1サイズダウン
- メモリ使用率が常に50%以下 → メモリ最適化インスタンスへ変更

#### Reserved Instance / Savings Plansの活用

**購入戦略:**
- 1年契約 vs 3年契約
- 全額前払い vs 一部前払い vs 前払いなし
- 標準RI vs コンバーティブルRI

**購入タイミング:**
- 3ヶ月以上の安定稼働実績
- 将来の利用予測
- 予算の確保状況

**管理のポイント:**
- 利用率の定期的な確認
- 未使用RIの特定と対策
- 更新時期の管理

### 見積もりテンプレート

#### 小規模案件（月額10万円以下）

**想定構成:**
- EC2: t3.small × 2台（Web/AP）
- RDS: db.t3.small（Single-AZ）
- ELB: Application Load Balancer
- S3: 100GB
- データ転送: 500GB/月

**概算コスト:**
```
EC2: ¥3,000 × 2 = ¥6,000
RDS: ¥5,000
ELB: ¥3,000
S3: ¥300
データ転送: ¥5,000
CloudWatch: ¥1,000
合計: 約¥20,000/月
```

#### 中規模案件（月額10-50万円）

**想定構成:**
- EC2: m5.large × 4台（Web/AP）+ Auto Scaling
- RDS: db.m5.large（Multi-AZ）
- ElastiCache: cache.m5.large
- ELB: Application Load Balancer
- S3: 1TB
- CloudFront
- データ転送: 2TB/月

**概算コスト:**
```
EC2: ¥15,000 × 4 = ¥60,000
RDS: ¥50,000
ElastiCache: ¥20,000
ELB: ¥3,000
S3: ¥3,000
CloudFront: ¥10,000
データ転送: ¥20,000
CloudWatch: ¥5,000
合計: 約¥170,000/月
```

#### 大規模案件（月額50万円以上）

**想定構成:**
- EC2: c5.2xlarge × 10台 + Auto Scaling
- RDS: db.r5.2xlarge（Multi-AZ） + Read Replica
- ElastiCache: cache.r5.xlarge × 2
- ELB: Application Load Balancer × 2
- S3: 10TB
- CloudFront
- Direct Connect
- データ転送: 10TB/月

**概算コスト:**
```
EC2: ¥50,000 × 10 = ¥500,000
RDS: ¥200,000
ElastiCache: ¥50,000 × 2 = ¥100,000
ELB: ¥6,000
S3: ¥30,000
CloudFront: ¥50,000
Direct Connect: ¥100,000
データ転送: ¥100,000
CloudWatch: ¥20,000
合計: 約¥1,100,000/月
```

### コスト最適化チェックリスト

- [ ] TCO分析の実施
- [ ] タグ戦略の策定
- [ ] コスト可視化ダッシュボードの構築
- [ ] 定期的なコストレビューの実施
- [ ] 未使用リソースの削除
- [ ] 開発環境の自動停止設定
- [ ] ストレージの最適化
- [ ] インスタンスサイズの見直し
- [ ] Reserved Instance/Savings Plansの検討
- [ ] Cost Anomaly Detectionの有効化
- [ ] 予算アラートの設定
- [ ] Trusted Advisorの定期確認

### コスト削減事例

#### 事例1: 開発環境の自動停止で70%削減
**課題:** 開発環境が24時間稼働していた
**対策:** 平日9:00-19:00のみ稼働するよう自動停止/起動を設定
**効果:** 月額30万円 → 9万円（70%削減）

#### 事例2: RIとSavings Plansで40%削減
**課題:** すべてオンデマンドで利用していた
**対策:** 安定稼働しているリソースにRI/Savings Plansを適用
**効果:** 月額100万円 → 60万円（40%削減）

#### 事例3: ストレージ最適化で50%削減
**課題:** 古いスナップショットが大量に残っていた
**対策:** Data Lifecycle Managerで自動削除、S3ライフサイクルポリシー設定
**効果:** ストレージコスト月額20万円 → 10万円（50%削減）
