# 可用性要件ヒアリング

## 質問項目

### 1. SLA（Service Level Agreement）
- **質問**: 「システムの稼働率目標はどのくらいですか？」
  - 99.9%（年間8.76時間のダウンタイム）
  - 99.95%（年間4.38時間）
  - 99.99%（年間52.6分）
  - 99.999%（年間5.26分）

- **質問**: 「計画メンテナンス時間は許容されますか？」
  - 許容される場合：メンテナンスウィンドウの設定
  - 許容されない場合：ゼロダウンタイムデプロイが必要

### 2. ダウンタイムの影響
- **質問**: 「システムが停止した場合のビジネスへの影響は？」
  - 金銭的損失（1時間あたりの損失額）
  - 顧客満足度への影響
  - 法的・契約的な影響

### 3. 障害復旧
- **質問**: 「目標復旧時間（RTO）はどのくらいですか？」
  - 即座（数分以内）
  - 1時間以内
  - 数時間以内
  - 1日以内

- **質問**: 「目標復旧時点（RPO）はどのくらいですか？」
  - データ損失は許容できない（RPO = 0）
  - 数分のデータ損失は許容可能
  - 数時間のデータ損失は許容可能

### 4. 地理的要件
- **質問**: 「複数リージョンでの展開は必要ですか？」
  - 単一リージョン
  - マルチリージョン（DR用）
  - マルチリージョン（アクティブ-アクティブ）

## AWSサービスマッピング

### 高可用性構成
- **Multi-AZ**: RDS、ElastiCache、ELB
- **Auto Scaling**: EC2、ECS、Lambda
- **Route 53**: ヘルスチェック、フェイルオーバー
- **CloudFront**: グローバル配信、DDoS保護

### DR（災害復旧）戦略
- **Backup and Restore**: AWS Backup、S3
- **Pilot Light**: 最小限のリソースを常時稼働
- **Warm Standby**: スケールダウンした環境を常時稼働
- **Multi-Site**: 完全なアクティブ-アクティブ構成

### データ保護
- **RDS**: 自動バックアップ、スナップショット、リードレプリカ
- **S3**: バージョニング、クロスリージョンレプリケーション
- **DynamoDB**: ポイントインタイムリカバリ、グローバルテーブル

## チェックリスト

- [ ] SLA目標値の確認
- [ ] RTO/RPOの確認
- [ ] ダウンタイムのビジネス影響評価
- [ ] 地理的冗長性の必要性
- [ ] バックアップ戦略の決定
- [ ] 監視・アラート要件の確認

## ナレッジ（随時追加）

### 事例・ベストプラクティス
<!-- ここに案件で得た知見を追加してください -->



---

## 実案件ナレッジ

### 継続性要件

#### 運用スケジュール
**稼働時間パターン:**
- 365日24時間稼働
- 営業時間のみ稼働（平日9:00-18:00など）
- 特定日のみ稼働
- 休日と夜間は停止

**計画停止:**
- 計画メンテナンスウィンドウの有無
- メンテナンス頻度（月次、四半期など）
- 許容される停止時間

#### 業務継続範囲
**サービス範囲の分類:**
- 社内サービス
- 外部向けサービス
- ミッションクリティカルなサービス
- 一般業務サービス

**障害時の継続要件:**
- 単一障害時に継続が必要なサービス
- 複合障害時に継続が必要なサービス
- 優先順位の設定

#### 目標復旧水準（業務停止時）

**RTO/RPO設定:**
- データ損失の許容可否
- 復旧時間目標（RTO）
- 復旧時点目標（RPO）
- サービス毎の設定

**データキャッシュ戦略:**
- 障害時のデータ保持場所の確認
- 前段でのデータキャッシュ（SQS、Kinesis等）
- 復旧後のデータ取り込み方法
- 例: EC2障害時にSQSでメッセージを保持し、復旧後に処理

**確認ポイント:**
- どのサービスで障害が起きてもデータがキャッシュされているか
- サービス復旧時に過去データを取り込める状態か
- 復旧後の取り込み方法（自動/手動）

#### 目標復旧水準（大規模災害時）

**災害時のRTO/RPO:**
- 大規模災害時のデータ損失許容度
- 通常障害時とは異なるRTO/RPO設定
- リージョン障害を想定した設計

**災害時のデータ保護:**
- クロスリージョンレプリケーション
- マルチリージョンバックアップ
- 災害時のフェイルオーバー手順

#### 稼働率要件

**SLA定義:**
- 年間許容停止時間
- 月間許容停止時間
- 計画停止の扱い（SLA計算に含むか）

**稼働率の例:**
- 99.9%: 年間8.76時間の停止許容
- 99.95%: 年間4.38時間の停止許容
- 99.99%: 年間52.6分の停止許容

### 耐障害性（冗長化）

#### EC2の冗長化
- マルチAZ配置（Active/Standby または Active/Active）
- Auto Scalingによる自動復旧
- ELBによる負荷分散とヘルスチェック

#### RDSの冗長化
- Multi-AZ配置（自動フェイルオーバー）
- リードレプリカ（読み取り負荷分散）
- 自動バックアップ設定

#### その他サービスの冗長化
- EFS: マルチAZ自動レプリケーション
- S3: 自動的に複数AZに保存
- DynamoDB: マルチAZ自動レプリケーション
- ELB: マルチAZ自動配置
- FSx: マルチAZ配置オプション

**冗長化設計図:**
- アーキテクチャ図に冗長構成を明示
- 単一障害点（SPOF）の排除確認

### 災害対策（DR戦略）

#### DR要件の決定
**災害の範囲:**
- 30km災害: マルチAZ対応
- 30km以上の災害: マルチリージョン対応

**DRサイトの種類:**
- マルチAZ構成
- マルチリージョン構成

#### DR方式の選択

**1. バックアップ・リストア方式**
- RTO: 数時間〜1日
- RPO: 数時間
- コスト: 最小
- 方法: S3バックアップからDRサイトに復元

**2. パイロットライト方式**
- RTO: 数十分〜数時間
- RPO: 数分〜数十分
- コスト: 低
- 方法: DRサイトのDBに常時データ同期、障害時にアプリ層を起動

**3. ウォームスタンバイ方式**
- RTO: 数分〜数十分
- RPO: 数秒〜数分
- コスト: 中
- 方法: スペックの低い構成をDRサイトに常時起動、障害時にスケールアップ

**4. マルチサイト（アクティブ-アクティブ）方式**
- RTO: ほぼゼロ
- RPO: ほぼゼロ
- コスト: 最大
- 方法: 同じ構成を複数サイトで常時稼働、Route 53で振り分け

#### サービス毎のDR設計例（マルチAZ）

**ネットワーク:**
- サブネット構成はマルチAZ
- 障害時は他AZのサブネットで運用

**コンピューティング:**
- EC2はマルチAZに配置（Active/Standby または Active/Active）
- Auto Scalingで自動復旧

**マネージドサービス:**
- ELB: 仕様上、複数AZを自動利用
- FSx: マルチAZ配置オプション
- AWS Managed Microsoft AD: 複数AZに自動配置

**データベース:**
- RDS Multi-AZ: 自動フェイルオーバー（1-2分）
- DynamoDB: 自動的にマルチAZ

### 回復性

#### 復旧手段の定義

**EC2基盤障害時:**
- Auto Recovery利用: 10〜20分程度で自動回復
- 手動での再起動: 5〜10分程度
- AMIからの再構築: 30〜60分程度

**AZ障害時:**
- 他AZのサブネットでバックアップから復元: 60分程度
- 特定サーバ: DNS切り替えによる冗長構成で10〜20分
- Webサーバ: ELBによる冗長構成で数分程度
- マネージドサービス: サービスの自動復旧時間に依存

**リージョン障害時:**
- DRサイトへのフェイルオーバー
- Route 53によるDNS切り替え
- データ同期状態の確認と整合性チェック

#### 復旧手順書（Runbook）
- 障害パターン毎の復旧手順
- エスカレーションフロー
- 連絡先リスト
- 復旧確認項目

#### 復旧訓練
- 定期的なDR訓練の実施（年1回、半年に1回など）
- 訓練結果の記録と改善
- 復旧手順書の更新

### 可用性設計チェックリスト

- [ ] 運用スケジュールの確認
- [ ] 計画停止の有無と頻度
- [ ] 業務継続範囲の定義
- [ ] RTO/RPO（通常時）の設定
- [ ] RTO/RPO（災害時）の設定
- [ ] 稼働率要件の確認
- [ ] 冗長化設計（各サービス）
- [ ] DR方式の選択
- [ ] DRサイトの構築（マルチAZ/マルチリージョン）
- [ ] データ同期方法の確認
- [ ] 復旧手順書の作成
- [ ] 復旧訓練計画の策定
- [ ] 監視・アラート設定
- [ ] 自動復旧機能の設定
