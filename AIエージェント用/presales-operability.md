# 運用性要件ヒアリング

## 質問項目

### 1. 監視・アラート
- **質問**: 「どのような監視が必要ですか？」
  - リソース監視（CPU、メモリ、ディスク）
  - アプリケーション監視（エラー率、レスポンスタイム）
  - ビジネスメトリクス監視
  - ユーザー体験監視（RUM）

- **質問**: 「アラート通知の方法は？」
  - メール
  - Slack/Teams
  - SMS
  - PagerDuty等のインシデント管理ツール

### 2. ログ管理
- **質問**: 「ログの保持期間は？」
  - アプリケーションログ
  - アクセスログ
  - 監査ログ

- **質問**: 「ログの分析要件は？」
  - リアルタイム分析
  - 定期的な分析
  - 長期保存のみ

### 3. デプロイ・変更管理
- **質問**: 「デプロイの頻度は？」
  - 1日複数回
  - 週次
  - 月次

- **質問**: 「デプロイ方式の要件は？」
  - Blue/Green デプロイ
  - カナリアリリース
  - ローリングアップデート
  - ダウンタイムを伴う変更

### 4. バックアップ・リストア
- **質問**: 「バックアップの頻度は？」
  - リアルタイム（継続的レプリケーション）
  - 時間単位
  - 日次
  - 週次

- **質問**: 「リストアのテスト頻度は？」
  - 月次
  - 四半期
  - 年次

### 5. 運用体制
- **質問**: 「運用チームの体制は？」
  - 24時間365日体制
  - 営業時間のみ
  - オンコール体制

- **質問**: 「運用の自動化レベルは？」
  - 完全自動化
  - 半自動化（承認プロセスあり）
  - 手動運用

### 6. パッチ管理
- **質問**: 「OSやミドルウェアのパッチ適用方針は？」
  - 自動適用
  - 定期メンテナンスウィンドウで適用
  - 手動適用

## AWSサービスマッピング

### 監視・可観測性
- **CloudWatch**: メトリクス、ログ、アラーム
- **CloudWatch Logs Insights**: ログ分析
- **X-Ray**: 分散トレーシング
- **CloudWatch RUM**: リアルユーザーモニタリング
- **CloudWatch Synthetics**: 合成モニタリング

### ログ管理
- **CloudWatch Logs**: ログ集約
- **S3**: 長期保存
- **Athena**: S3上のログ分析
- **OpenSearch Service**: ログ検索・可視化

### デプロイ・CI/CD
- **CodePipeline**: CI/CDパイプライン
- **CodeDeploy**: デプロイ自動化
- **CodeBuild**: ビルド自動化
- **CodeCommit**: ソースコード管理

### インフラ管理
- **Systems Manager**: パッチ管理、運用タスク自動化
- **CloudFormation**: IaC、スタック管理
- **Terraform**: マルチクラウドIaC
- **OpsWorks**: 構成管理

### バックアップ
- **AWS Backup**: 一元的なバックアップ管理
- **RDS自動バックアップ**: データベースバックアップ
- **EBS Snapshots**: ボリュームスナップショット

### 自動化
- **Lambda**: イベント駆動の自動化
- **EventBridge**: イベントルーティング
- **Step Functions**: ワークフロー自動化
- **Systems Manager Automation**: 運用タスク自動化

## チェックリスト

- [ ] 監視対象の特定
- [ ] アラート通知先の設定
- [ ] ログ保持期間の決定
- [ ] デプロイ方式の決定
- [ ] バックアップ戦略の決定
- [ ] リストアテスト計画
- [ ] 運用体制の確認
- [ ] 自動化スコープの決定
- [ ] パッチ管理方針の決定
- [ ] ドキュメント整備計画

## 運用設計のポイント

### 監視ダッシュボード
- システム全体の健全性を一目で確認
- 重要メトリクスの可視化
- 異常検知の自動化

### インシデント対応
- エスカレーションフロー
- 対応手順書（Runbook）
- ポストモーテム（振り返り）

### 変更管理
- 変更申請プロセス
- ロールバック手順
- 変更履歴の記録

## ナレッジ（随時追加）

### 事例・ベストプラクティス
<!-- ここに案件で得た知見を追加してください -->

### 運用自動化の事例
<!-- 実際の自動化施策と効果を追加 -->


---

## 実案件ナレッジ

### 運用時間

**運用監視時間帯:**
- 24時間365日体制
- 定時内のみ（例: 9時〜17時）
- 営業日のみ（平日9時〜18時など）
- オンコール体制（夜間・休日は待機）

**特定休日:**
- 年末年始（12/29〜1/3など）
- ゴールデンウィーク
- お盆期間
- その他組織固有の休日

**運用体制:**
- 一次対応窓口
- エスカレーション先
- 緊急連絡体制

### バックアップ

#### バックアップ要件の定義

**利用範囲:**
- 障害時のみ
- 障害時と作業ミス時
- 定期的なデータ保全
- 監査・コンプライアンス対応

**自動化の範囲:**
- 完全自動化（スケジュール実行）
- 半自動化（手動トリガー、自動実行）
- 手動バックアップ

#### サービス別バックアップ設計

**EC2のバックアップ:**
- バックアップ方式: EBSスナップショット、AMI作成
- 取得間隔: 1日1回（深夜帯）、週1回など
- 保存期間: 5日分、7日分、30日分など
- 自動化: AWS Backup、Data Lifecycle Manager、Lambda
- バックアップ方式: オンライン（停止不要）

**RDSのバックアップ:**
- 自動バックアップ: 有効化（保持期間1〜35日）
- 手動スナップショット: 必要に応じて取得
- 取得間隔: 自動バックアップは毎日
- 保存期間: 7日分、14日分、30日分など
- バックアップウィンドウ: 業務影響の少ない時間帯
- クロスリージョンコピー: DR対策として実施

**S3のバックアップ:**
- バージョニング: 有効化
- クロスリージョンレプリケーション: DR対策
- ライフサイクルポリシー: 古いバージョンの自動削除
- S3 Object Lock: 改ざん防止（WORM）

**DynamoDBのバックアップ:**
- オンデマンドバックアップ: 必要時に取得
- ポイントインタイムリカバリ（PITR）: 35日間の継続的バックアップ
- AWS Backupによる一元管理

**EFSのバックアップ:**
- AWS Backupによる自動バックアップ
- 取得間隔: 1日1回など
- 保存期間: 設定に応じて

#### バックアップ設計例

```
EC2（Webサーバ）:
- 方式: EBSスナップショット
- 間隔: 1日1回（AM 3:00）
- 保存: 7日分
- 自動化: AWS Backup

RDS（データベース）:
- 方式: 自動バックアップ + 手動スナップショット
- 間隔: 自動バックアップ毎日、手動は月次
- 保存: 自動14日分、手動3ヶ月分
- バックアップウィンドウ: AM 2:00-3:00
```

### 運用監視

#### 監視項目の定義

**EC2監視項目:**
- CPU使用率（閾値: 80%、90%）
- メモリ使用率（閾値: 80%、90%）
- ディスク使用率（閾値: 80%、90%）
- ディスクI/O
- ネットワークトラフィック
- プロセス監視（重要プロセスの稼働確認）
- ステータスチェック（システム、インスタンス）

**RDS監視項目:**
- CPU使用率
- メモリ使用率（Freeable Memory）
- ストレージ使用率
- データベース接続数
- レプリケーション遅延（Read Replica使用時）
- スロークエリログ

**ログ監視:**
- アプリケーションログ（エラー、警告）
- システムログ（/var/log/messages等）
- 監査ログ（アクセスログ、変更ログ）
- CloudTrail（AWS API監査）
- VPCフローログ（ネットワークトラフィック）

**セキュリティ監視:**
- GuardDuty（脅威検知）
- AWS Config（設定変更監視）
- Security Hub（セキュリティ状態の一元管理）
- CloudTrail（不正アクセス検知）

#### 監視ツール

**CloudWatch:**
- メトリクス監視
- ログ監視（CloudWatch Logs）
- アラーム設定
- ダッシュボード作成

**サードパーティツール:**
- DataDog
- New Relic
- Mackerel
- Zabbix

**監視統合例:**
```
CloudTrail, AWS Config, GuardDutyを
DataDogで一元監視
- ダッシュボードで可視化
- アラート通知（Slack、メール）
- インシデント管理
```

### パッチ適用ポリシー

#### EC2のパッチ適用

**適用方法:**
- Systems Manager（SSM）Patch Manager
- Cloud Automator（Windows Update）
- 手動適用（例外的）

**Linux系OS:**
- SSM Patch Managerを利用
- yum update、apt updateの自動実行
- パッチベースラインの設定

**Windows OS:**
- Cloud AutomatorのWindows Update機能
- またはSSM Patch Manager
- Windows Updateの自動適用

**適用スケジュール:**
- 月1回（第2火曜日など）
- メンテナンスウィンドウ: 5時間
- 実施時間帯: 深夜帯（AM 2:00〜7:00）

**適用フロー:**
1. パッチ情報の確認
2. 検証環境での適用テスト
3. 本番環境への適用
4. 適用後の動作確認
5. ロールバック手順の準備

#### RDSのパッチ適用

**適用方法:**
- メンテナンスウィンドウを利用
- 自動適用または手動適用

**メンテナンスウィンドウ設定:**
- 曜日・時間帯の指定
- 業務影響の少ない時間帯を選択
- Multi-AZ構成では数分のダウンタイム

**パッチ種別:**
- マイナーバージョンアップグレード
- セキュリティパッチ
- メジャーバージョンアップグレード（計画的に実施）

### 障害時運用（復旧）

**対応可能時間:**
- 24時間365日対応
- 営業時間内のみ対応
- オンコール体制（30分以内に対応開始）

**担当者:**
- 一次対応: 運用チーム
- 二次対応: 技術チーム
- エスカレーション: マネージャー、ベンダー

**復旧範囲:**
- 完全復旧（全機能回復）
- 部分復旧（重要機能のみ）
- 暫定対応（Sorryページ表示）

**復旧作業開始までの時間:**
- 即座（監視アラート検知後すぐ）
- 30分以内
- 1時間以内
- 営業時間開始後

**復旧手順:**
- Runbook（復旧手順書）の整備
- 障害パターン別の手順
- エスカレーションフロー
- 連絡先リスト

### 運用環境

**環境構成:**
- 本番環境のみ
- 本番環境 + 検証環境
- 本番環境 + ステージング環境 + 開発環境

**各環境の用途:**
- 本番環境: 実運用
- ステージング環境: 本番リリース前の最終確認
- 検証環境: パッチ適用テスト、機能検証
- 開発環境: 開発・単体テスト

**性能試験環境:**
- 専用の性能試験環境の有無
- 本番同等のスペック
- 試験後の環境削除（コスト削減）

### 運用マニュアル

**想定されるマニュアル:**
- 運用手順書
- 障害対応手順書（Runbook）
- バックアップ・リストア手順書
- パッチ適用手順書
- 監視・アラート対応手順書
- デプロイ手順書
- セキュリティインシデント対応手順書
- エスカレーション手順書

**マニュアル管理:**
- ドキュメント管理場所（Confluence、SharePoint等）
- 更新頻度（四半期、半期など）
- バージョン管理

### リモートオペレーション

**アクセス方法:**
- VPN経由でのアクセス
- AWS Systems Manager Session Manager
- 踏み台サーバ経由
- AWS Client VPN

**セキュリティ方針:**
- 秘密鍵やパスワードは踏み台サーバに配置しない
- デフォルトユーザー（ec2-user等）は削除
- rootでのログインは不可
- 個人ユーザーアカウントの発行
- MFA（多要素認証）の利用

**アクセス制御:**
- IAMロールによる権限管理
- セキュリティグループによるIP制限
- アクセスログの記録（CloudTrail）

**ユーザー管理:**
- OSユーザーは利用者が作成
- 運用部門用のユーザーを発行
- 定期的なアクセス権限の棚卸し

### 外部システム接続

**接続先システム:**
- 社内システム（オンプレミス）
- 他社システム（SaaS、パートナー）
- 外部API

**接続方式:**
- HTTPS接続
- FTP/SFTP接続
- VPN接続（Site-to-Site VPN）
- Direct Connect
- PrivateLink

**接続要件:**
- 通信プロトコル
- 認証方式
- データフォーマット
- 連携頻度
- エラーハンドリング

### サポート体制（保守契約）

**サポート窓口:**
- 一次対応窓口（ヘルプデスク）
- 技術サポート窓口
- 緊急連絡先

**保守契約:**
- AWSサポートプラン（Business、Enterprise）
- ベンダーサポート契約
- 運用保守契約

**サポート範囲:**
- 障害対応
- 問い合わせ対応
- パッチ適用支援
- 定期メンテナンス
- 導入サポート

**SLA:**
- 対応時間
- 復旧時間目標
- 問い合わせ応答時間

### ライフサイクル期間

**システム更改計画:**
- システムのライフサイクル（3年、5年など）
- OS保守期限の確認
- ミドルウェアのEOL（End of Life）
- AWSサービスの廃止予定

**計画的な更新:**
- OSバージョンアップ計画
- データベースバージョンアップ計画
- アプリケーションの改修計画

**EOL対応:**
- Amazon Linux 2のEOL: 2025年6月30日
- Windows Server 2012のEOL: 2023年10月10日
- 計画的な移行作業

### 定期報告

**報告内容:**
- システム稼働状況
- 障害発生状況
- リソース使用状況
- コスト状況
- セキュリティ状況
- パッチ適用状況

**報告頻度:**
- 月次報告
- 四半期報告
- 年次報告

**報告形式:**
- レポート作成
- 定例会議での報告
- ダッシュボードでの可視化

### デプロイ基盤

**CI/CDパイプライン:**
- CodePipeline + CodeBuild + CodeDeploy
- GitHub Actions + AWS
- Jenkins + AWS
- GitLab CI/CD

**デプロイ方式:**
- Blue/Greenデプロイ
- カナリアリリース
- ローリングアップデート

**デプロイ自動化:**
- Gitへのプッシュをトリガー
- 自動テスト実行
- 自動デプロイ
- ロールバック機能

### ドメイン管理

**ドメイン取得・管理:**
- Route 53でのドメイン登録
- 外部レジストラでの管理
- サブドメインの管理

**DNS設定:**
- Route 53でのホストゾーン管理
- レコード設定（A、CNAME、MX等）
- ヘルスチェック設定
- フェイルオーバー設定

**SSL/TLS証明書:**
- ACM（AWS Certificate Manager）での管理
- 外部CAからの購入
- 自動更新設定

### 運用性設計チェックリスト

- [ ] 運用監視時間の確認
- [ ] バックアップ要件の定義
- [ ] 監視項目の設定
- [ ] パッチ適用ポリシーの策定
- [ ] 障害時復旧手順の整備
- [ ] 運用環境の構成決定
- [ ] 運用マニュアルの作成
- [ ] リモートアクセス方法の決定
- [ ] 外部システム接続の確認
- [ ] サポート体制の確立
- [ ] ライフサイクル計画の策定
- [ ] 定期報告の要否確認
- [ ] CI/CDパイプラインの構築
- [ ] ドメイン・DNS管理方法の決定
